#!/bin/zsh

function hl() {
  if [ $# -eq 0 ]; then
    echo "Usage: $0 xx"
    return 1
  fi
}

function nodePro() {
  # https://docs.npmjs.com/cli/v10/commands/npm  (version publish query)
  # https://pnpm.io/cli/add  (workspaces patch )
  # pnpm v7 æ–‡æ¡£ https://github.com/pnpm/pnpm.io/blob/v7/docs/workspaces.md

  # --loglevel silly --yes --no-commit-hooks
  # --include-merged-tags --no-push --no-git-tag-version
  npx lerna diff
  npx lerna changed
  npx lerna changed --include-merged-tags
  npx lerna version patch --exact
  npx lerna version patch --exact --message 'ğŸ¨ chore(release): Publish' --conventional-commits
  npx lerna version prerelease --preid beta
  npx lerna publish prerelease --preid rc --dist-tag rc
  npx lerna publish from-git --preid rc --dist-tag rc
  npx lerna publish from-package

  npx lerna ls --since="master"
  npx lerna ls --include-merged-tags
  npx lerna ls --since --include-merged-tags
  npx lerna exec --since --include-merged-tags -- ls -la
  npx lerna exec --include-merged-tags --concurrency 1 -- "pwd && ls -la"
  npx lerna exec --scope @afe/pro-form -- pnpm version 0.1.5-alpha.0 --no-git-tag-version

  # ä½¿ç”¨ lerna version å‰å¿…è¯» https://docs.npmjs.com/cli/v10/commands/npm-version
  # æ ¹ç›®å½•æ˜¯ monorepo åœ¨æ ¹ç›®å½•è¿è¡Œ
  npm version 0.1.5 --workspaces --no-git-tag-version --allow-same-version=true
  npm version patch --workspace=packages/button --workspace=packages/card --no-git-tag-version --allow-same-version=true -f
  # å¦‚æœåªæ”¹æŸä¸ªå­åŒ…ç‰ˆæœ¬å·ï¼Œè¿›å…¥åˆ°å­åŒ… è®¾ç½® --workspaces=false
  npm version patch --workspaces=false --no-git-tag-version
  npm version prerelease --preid rc --no-git-tag-version

  # pnpm å¤„ç† workspaces ( pnpm>9.0 link-workspace-packages é»˜è®¤ä¸º false )
  pnpm run script-name --filter workspace-name
  pnpm add package-name --filter workspace-name --link-workspace-packages=true

  # æ³¨æ„ pnpm outdated æ˜¯æ£€æµ‹ lockæ–‡ä»¶(ä¸æ˜¯package.json) é‡Œçš„ä¾èµ–ç‰ˆæœ¬å· æ˜¯å¦è¿‡æ—¶
  pnpm outdated -r
  pnpm outdated "@afe/pro-*" --filter "@afe/pro-form" --json
  # pnpm up package-name --filter workspace-name
  pnpm up "@afe/pro-*" --filter "@afe/pro-form" --latest

  pnpm up -r @afe/pro-form@0.2.0  # æ›´æ–°ä¸å­˜åœ¨çš„ç‰ˆæœ¬å·ä¼šæŠ¥é”™
  # æ›´æ–° åŒ…çš„ç‰ˆæœ¬å·ä¸º "@afe/pro-form": "workspace:0.1.3"
  pnpm up -r "@afe/pro-*"  # åŠ  --workspace ä½œç”¨ä¸€æ ·
  # å‡çº§åˆ° npm latest æŒ‡å®šçš„ç‰ˆæœ¬
  # å¦‚æœ workspace å†…éƒ¨åŒ… ç‰ˆæœ¬å·å¤§äºnpmæœ€æ–°ç‰ˆ åˆ™ä½¿ç”¨å†…éƒ¨åŒ…ç‰ˆæœ¬å·
  pnpm up -r "@afe/pro-*" --latest
  pnpm up -r "@afe/pro-*@beta"  # å‡çº§åˆ° beta rc

  pnpm install --ignore-engines --ignore-platform
  pnpm view @afe/pro-card --json --registry http://comm

  pnpm ls -r --json # ç­‰æ•ˆ npx lerna ls --graph
  pnpm ls -r --depth -1 --json  # ç­‰æ•ˆ npx lerna ls --long æ¢æˆ npm ä¸è¡Œ
  npm ls pkg_name
  npm ls --all --json --loglevel silent
  npm ls --all -g
  npm ls -g
  npm update package1 package2 --save
  npm root -g
  which npm/node  # æŸ¥çœ‹æœ¬åœ°å®‰è£…çš„æ¨¡å—

  # npx ç”¨æ³•
  npx ls  # ç­‰åŒäº ls
  npx mocha --version
  npx http-server
  # å¿½ç•¥æœ¬åœ°çš„åŒåæ¨¡å— --no-install å¼ºåˆ¶ä½¿ç”¨æœ¬åœ°æ¨¡å—
  npx --ignore-existing http-server
  # https://code.visualstudio.com/api/get-started/your-first-extension
  npx --package yo --package generator-code -- yo code

  # æœç´¢ç»„ç»‡ä¸‹çš„åŒ… https://www.npmjs.com/org/ant-design
  npm --searchlimit=100 search @ant-design
  npm config ls
  npm config set registry https://registry.npmmirror.com -g
  npm i --registry https://registry.npmmirror.com
  npm i --registry https://registry.npmjs.org
}
function gitPro() {
  git config -l  # --list

  code ~/.zsh_history
  code ~/.gitconfig
  code ~/.gitconfig-github
  open https://github.com/paulirish/git-open
  open https://gitlab.com/warmhug/test

  # å¯¹æ¯” feat åˆ†æ”¯å’Œ master çš„å·®å¼‚
  git cherry -v master feat-xx
  git log master..feat-xx --oneline
  git diff master..feat-xx

  # åˆ›å»ºä¸€ä¸ªä¸´æ—¶ç›®å½•ç”¨äºå­˜å‚¨ other-branch çš„æ–‡ä»¶
  mkdir /tmp/other
  # åˆ‡æ¢åˆ° other-branchï¼Œå¹¶å°†å…¶å†…å®¹å¯¼å‡ºåˆ°ä¸´æ—¶ç›®å½•
  git --work-tree=/tmp/other checkout other-branch -- .
  diff -r . /tmp/other
  diff -rq . /tmp/other  # -q åªæŠ¥å‘Šå“ªäº›æ–‡ä»¶ä¸åŒ
  diff -r --exclude=".git" . /tmp/other
  # ä½¿ç”¨ --exclude="{.git,.svn}" å¥½åƒä¸æ­£ç¡®
  diff -r --exclude=".git" --exclude=".svn" dir1 dir2
  diff -r --exclude=".git" dir1 dir2 dir3 > diff_output.txt

  # åˆ›å»ºå’Œ apply è¡¥ä¸
  # å½“å‰ä¸º branch-a åˆ†æ”¯ï¼Œæƒ³åº”ç”¨ branch-b ç›¸å¯¹äº branch-a çš„æ›´æ”¹
  git diff branch-a..branch-b > changes.patch
  git diff branch-a..branch-b -- path/to/file > changes.patch
  git apply changes.patch

  git log -n 10
  git log --graph
  git log --oneline --decorate
  git log --oneline --first-parent --reverse | tail -1
  git log --graph --pretty="%Cred%h%Creset -%C(auto)%d%Creset %s %Cgreen(%ar) %C(bold blue)<%an>%Creset" --all
  git log --graph --pretty="%Cred%h%Creset -%C(auto)%d%Creset %s %Cgreen(%ar) %C(bold blue)<%an>%Creset"

  git diff --name-only version1/branch1 version2/branch2
  # æ¯”è¾ƒå½“å‰åˆ†æ”¯å’Œ master åˆ†æ”¯çš„å®é™…ä¸åŒçš„å†…å®¹
  git diff --name-only master..HEAD
  git diff master..HEAD -b -w --ignore-blank-lines --ignore-space-change --ignore-all-space -p --stat [file/dir]
  git diff master..HEAD -b -w --ignore-blank-lines --ignore-space-change --ignore-all-space --name-only
  git diff @{upstream}
  git commit --amend  # ä¿®æ”¹æäº¤ä¿¡æ¯

  # å‹ç¼© commit
  git merge --squash feature-branch
  # ä¿ç•™å‹ç¼©å‰çš„æ‰€æœ‰commitä¿¡æ¯ å…¶ä¸­çš„ hash ä¿®æ”¹è®°å½• ä¹Ÿä¼šè¢«ä¿ç•™
  git add .
  git commit --no-verify

  # git merge ä¼šäº§ç”Ÿé‡å¤æ— ç”¨çš„ Merge pull request pull_id from xx_branch æˆ–è€… Merge branch â€œbranch_nameâ€ ä¿¡æ¯ï¼Œä¸åˆ©äº review æäº¤è®°å½•ã€‚
  # git rebase éœ€è¦ç»å¸¸ reapply å…¶ä»–æäº¤çš„æ”¹åŠ¨ï¼Œcommit çš„æ—¶é—´é¡ºåºä¹Ÿä¼šä¹±æ‰ã€‚åªå¯¹è‡ªå·±çš„åˆ†æ”¯ commit åš rebaseï¼Œå…¬å…±çš„åˆ†æ”¯ä¸è¦ rebase. å…¶åç»­çš„ commit hash å°†å…¨éƒ¨æ”¹å˜
  git rebase -i [commit_id] # hash æ¢æˆ master
  git rebase -i --root # åˆ é™¤ç¬¬ä¸€ä¸ªæäº¤
  git rebase origin/master
  git push --force-with-lease  # å¼ºåˆ¶æäº¤ æ¯” -f å®‰å…¨

  git reset [file | 057d]    # å›é€€æ–‡ä»¶ã€æˆ–å›é€€åˆ°æŸä¸ªç‰ˆæœ¬
  git reset HEAD^ [file]   # å›é€€ æ‰€æœ‰å†…å®¹æˆ–æŸä¸ªæ–‡ä»¶ åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
  git revert commit_id # å›æ»šä»£ç  ä¸æŠ¹æ‰ æäº¤è®°å½• äº§ç”Ÿæ–°çºªå½•
  # --soft ä¸ä¿®æ”¹æœ¬åœ°æ–‡ä»¶ --hard æœ¬åœ°çš„æ–‡ä»¶ä¿®æ”¹éƒ½è¢«ä¸¢å¼ƒ
  git reset --[soft | hard] [HEAD^ | 057d]
  git reset --hard origin/master   # å°†æœ¬åœ°çš„çŠ¶æ€å›é€€åˆ°å’Œè¿œç¨‹çš„ä¸€æ ·
  git reflog  # æ’¤é”€ reset æ—¶ æ‰¾åˆ°æ’¤é”€å‰çš„ commit_id å† git reset å³å¯

  # è§£å†³å†²çª
  # Git åˆå¹¶å‡ºç°å†²çªçš„åŸå› åœ¨äº ä¸¤ä¸ªåˆ†æ”¯ç‰ˆæœ¬å¯¹ä¸€ä¸ªæ–‡ä»¶çš„åŒä¸€åŒºåŸŸ åšäº†ä¿®æ”¹ã€‚å¦‚æœæ˜¯ä¸åŒåŒºåŸŸï¼ŒGit ä¼šå°è¯•è‡ªåŠ¨åˆå¹¶ï¼ˆauto-mergeï¼Œé»˜è®¤ç­–ç•¥ï¼‰è§£å†³å†²çªã€‚ https://www.freecodecamp.org/news/resolve-merge-conflicts-in-git-a-practical-guide/
  # æ“ä½œ https://stackoverflow.com/a/930495/2190503
  git stash push lock.yaml  # æš‚å­˜ lock æ–‡ä»¶ï¼Œä½¿ç”¨å½“å‰ lock æ–‡ä»¶
  git checkout --ours "*lock*" # ä½¿ç”¨ å½“å‰æˆ–ç›®æ ‡(--theirs) çš„ lock æ–‡ä»¶
  # åœ¨ .gitattributes æ–‡ä»¶é‡Œé…ç½® å½“ pnpm-lock.yaml å‡ºç°å†²çªæ—¶ï¼Œå°†ä»¥å½“å‰åˆ†æ”¯ä¸ºå‡†
  pnpm-lock.yaml merge=ours

  # pristine
  git reset --hard && git clean --force -dfx
  # wipe
  git reset --hard && git clean --force -df
  #
  git pull --rebase       # åŒ git fetch + git rebase

  # æ‰“ annotated tags
  git tag -v @afe/pro-components@0.1.9-beta.0
  git tag -a 0.0.1 -m 'Release version 0.0.1'
  git fetch --all --tags
  git push [origin] --tags    # æ¨é€æ‰€æœ‰æ ‡ç­¾åˆ°æœåŠ¡å™¨
  git push origin --delete tag_name
  # tag åªé™„åœ¨ä¸€ä¸ª commit ä¸Šã€å¦‚æœè¿™ä¸ª commit è¢« squashï¼Œä½† tag ä»ç„¶å­˜åœ¨ã€‚
  # https://stackoverflow.com/questions/54281360/what-happens-to-tags-of-squashed-commits

  # ä»å¦ä¸€ä¸ªä»“åº“çš„åˆ†æ”¯ pick å…ˆ git fetch <other-repo-url> <other-branch>
  git cherry-pick commit-hash # commit-hash å¯ä»¥æ˜¯å…¶ä»–ä»“åº“çš„hash

  git stash show --patch
  git worktree list
  cd "$(git rev-parse --show-toplevel || echo .)"
  # push_beta="branch=$(git rev-parse --symbolic-full-name --abbrev-ref HEAD) && echo ${branch}"

  git remote [-v add | set-url] origin git@xxx.git

  # GitHub stars topics/javascript
  # https://github.com/search?q=stars:%3E1&s=stars&type=Repositories
  # https://github.com/topics/javascript

  # æœç´¢ issues
  # https://help.github.com/articles/searching-issues/
  # https://github.com/search?type=Issues&q=xx+in:body+author:warmhug
  # https://github.com/search?type=Issues&q=xx+commenter:warmhug+user:ant-design
  # https://github.com/search?type=Issues&q=xx+commenter:warmhug+repo:ant-design/ant-design-mobile

  # GitHub commit æˆ–åˆå¹¶ MR æ—¶ï¼Œå¯ä»¥è‡ªåŠ¨ä¿®æ”¹ issue çŠ¶æ€ã€å…³é—­å…³è”çš„ issueã€‚
  # ä¸šå†…æˆç†Ÿçš„ GIT åˆ†æ”¯æ¨¡å‹ https://cloud.githubusercontent.com/assets/36899/7315642/015f534c-eaa2-11e4-9882-b7cc7535fb72.png
  # GitHub Issues blog https://gitblog.io/
}

function file_opt() {
  return 1
  more filename # ä¸€é¡µä¸€é¡µçš„æ˜¾ç¤ºæ¡£æ¡ˆå†…å®¹.
  head/tail -n 20 ~/.zsh_history  # åªçœ‹ å¤´/å°¾ å‡ è¡Œ(é»˜è®¤10è¡Œ)
  history 10 # åˆ—å‡º10æ¡
  mv fname rename / cat -n fname / say hello / type -a node(pwd) / ln -s source_file dist
  env / w / who / whoami / tty / last / nettop / nslookup / mtr -r
  date # æ˜¾ç¤ºç³»ç»Ÿçš„å½“å‰æ—¥æœŸå’Œæ—¶é—´ date "+%Y-%m-%d_%H:%M:%S"

  curl https://www.baidu.com -o xx.html  # ä¸‹è½½é¡µé¢åˆ° xx.html é‡Œ

  mkdir -p ~/inner/aa && touch $_/file.txt  # åˆ›å»ºç›®å½•å¹¶èƒ½ç”Ÿæˆæ–‡ä»¶

  echo ttt > ./file.txt  # è¦†ç›–æ–‡ä»¶åŸå†…å®¹å¹¶é‡æ–°è¾“å…¥å†…å®¹ï¼Œè‹¥æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºæ–‡ä»¶
  echo `which node` >> ./file.txt  # å‘æ–‡ä»¶è¿½åŠ å†…å®¹ï¼ŒåŸå†…å®¹å°†ä¿å­˜

  grep -rn 'grep' *  # ä»¥ å­—ç¬¦ä¸² grep æ¥æœç´¢ å½“å‰ç›®å½•åŠå­ç›®å½• çš„æ‰€æœ‰æ–‡ä»¶å†…å®¹
  grep grep$ she*.md  # ä»¥ æ­£åˆ™è¡¨è¾¾å¼ grep$ æ¥æœç´¢ å½“å‰ç›®å½•ä¸‹ æ–‡ä»¶ååŒ¹é… she*.md çš„å†…å®¹
  grep -r --include=\*.{cpp,h} pattern ./
  grep -r --exclude-dir=node_modules pattern ~/

  # ls å‘½ä»¤é»˜è®¤åªæ˜¾ç¤ºæ–‡ä»¶å
  ls -d $PWD/*
  ls -la
  find . -name '*bash*'
  find . -name "*.js" -not -path "*node_modules*" -not -path "*js-css-html*"
  find . -name '*.DS_Store' -type f -delete   # åˆ é™¤æŸç›®å½•åŠå­ç›®å½•ä¸‹çš„ .DS_Store æ–‡ä»¶
  # find / -mmin -5   # æŸ¥æ‰¾åœ¨ç³»ç»Ÿä¸­æœ€å5åˆ†é’Ÿé‡Œä¿®æ”¹è¿‡çš„æ–‡ä»¶(modify time)
}

function mac() {
  return 1

  printenv HOME  # æ‰“å°ç¯å¢ƒå˜é‡
  echo "system: $HOME $PATH $SHELL"
  ls /usr/bin  # æœ‰ env
  ls /usr/local/bin  # æœ‰ node npm npx
  ls $HOME/bin  # ä¸€èˆ¬ä¸å­˜åœ¨

  open -a Activity\ Monitor # æ‰“å¼€æ´»åŠ¨ç›‘è§†å™¨ æˆ–è€… "Activity Monitor"
  top # æˆ– top -o cpu æŒ‰ q é€€å‡º.  man top
  ps -ax
  ps -ef | grep adb  # æœ‰æ—¶å€™ adb devices æ²¡ååº” éœ€è¦æ€æ‰è¿›ç¨‹é‡å¯
  lsof -i:8087   # æŸ¥æ‰¾å‡ºå ç”¨äº†æŸä¸ªç«¯å£çš„ç¨‹åºå’Œå…¶å¯¹åº”çš„PID
  kill 3747(è¿›ç¨‹id)  # æ€æ‰åå°è¿›ç¨‹
  kill -9 $(lsof -ti:3000,3001)  # æ€æ‰ç«¯å£å ç”¨çš„è¿›ç¨‹
  kill -9 *pid*  # å¼ºåˆ¶æ€æ‰è¿›ç¨‹

  zsh_stats  # å‘½ä»¤ä½¿ç”¨çŠ¶æ€

  # brew å›½å†…æº https://www.jianshu.com/p/bea984d27cd2
  cd/ls/tree "$(brew --repo)"
  brew config
  # æ›´æ¢ home-bottles
  export HOMEBREW_BOTTLE_DOMAIN=http://mirrors.aliyun.com/homebrew/homebrew-bottles
  brew install tree

  xcode-select --install  # å®‰è£… git gcc
  # é˜»æ­¢ç”µè„‘ç¡çœ  åŒæ—¶æŒ‰ä½ shiftã€controlã€ç”µæºé”®ï¼Œå…³é—­æ˜¾ç¤ºå™¨
  # pmset noidle

  # defaults read com.apple.screencapture  # æŸ¥çœ‹ç³»ç»Ÿæˆªå›¾è®¾ç½®
  # å°†ç³»ç»Ÿæˆªå±åå›¾ç‰‡ä¿å­˜ä¸º jpg æ ¼å¼ï¼Œä½“ç§¯æ¯”åŸ png æ ¼å¼æ˜¾è‘—ç¼©å°
  defaults write com.apple.screencapture type jpg
  # ä¿®æ”¹æˆªå±å›¾ç‰‡ä¿å­˜è·¯å¾„
  defaults write com.apple.screencapture location ~/Downloads/

  sips -z height width [file]
  # æ‰¹é‡ä¿®æ”¹ å®½æˆ–é«˜ æœ€å¤§å€¼ ä¿æŒå®½é«˜æ¯”
  sips -Z 640 *.jpg

  # zipåŠ è§£å¯† https://www.jianshu.com/p/bf4a6244180f
  zip -e output.zip ~/xx.txt

  # æŸ¥çœ‹çŠ¶æ€
  csrutil status
  # å…³é—­ sip å…³æœºã€æŒ‰ä½ç”µæºé”®(ém1æŒ‰ä¸‹`Cmd R`) é€‰æ‹©å®ç”¨å·¥å…·->ç»ˆç«¯
  # csrutil disable

  # å…è®¸å®‰è£…â€ä»»ä½•æ¥æºâ€œçš„è½¯ä»¶ï¼Œè§£å†³ Movist.appå·²æŸå é—®é¢˜
  sudo spctl --master-disable
  # macOS 14.4 ä»¥ä¸Šç‰ˆæœ¬ï¼Œéœ€è¦è¿è¡Œæ­¤å‘½ä»¤å å†å³é”®æ‰“å¼€
  xattr -cr /Applications/Movist.app

  # æŸ¥çœ‹æœ¬æœºå†…ç½‘IP
  ifconfig
  # æŸ¥çœ‹æœ¬æœºå…¬ç½‘IP
  curl ipinfo.io/json  # curl ifconfig.me

  # æŸ¥çœ‹åŸŸåè·¯ç”± æˆ– `ping baidu.com`
  traceroute baidu.com
}

function commit() {
  # printf "\n"
  echo "\033[32m git op (y/n)?  \033[0m"
  read git_op
  [[ $git_op = "n" ]] && exit
  BASEDIR=$(dirname $0)
  ## echo $BASEDIR
  cd $BASEDIR
  echo "\033[32m git status \033[0m"
  git st
  echo "\033[32m git add -A \033[0m"
  git add -A
  echo "\033[32m git ci \033[0m"
  git ci -a -m 'autocommit'
  echo "\033[32m git push \033[0m"
  git push
  read -p "Press Return to Close..."
}

function note() {
  code /Users/hua/Library/CloudStorage/OneDrive-Personal/_misc.txt
  code /Users/hua/Library/CloudStorage/OneDrive-Personal/_life.txt
  code /Users/hua/Library/CloudStorage/OneDrive-Personal/_work.txt
}

function setAlias() {
  #
  alias proxy='export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890'
  alias py='python3 -m http.server 3000'

  # pnpm i å¦‚æœå®‰è£…æŠ¥é”™ï¼Œæ¯”å¦‚ node pnpm ç‰ˆæœ¬æœ‰åˆ‡æ¢ã€å°è¯•æ¸…ç©ºé‡è£…
  alias re='rm pnpm-lock.yaml && git clean -xdf && pnpm store prune && pnpm i'

  alias gaa='git add --all'
  alias gb='git branch'
  alias gba='git branch --all'
  # åˆ é™¤æœ¬åœ°é™¤ å½“å‰å’Œmaster åˆ†æ”¯å¤–çš„å…¶ä»–åˆ†æ”¯
  alias gbd='git branch | grep -v "master" | xargs git branch -D'
  alias gc='git checkout'
  alias gd='git diff'
  alias gl='git log'
  alias glp='git log -p'
  alias gp='git pull -p'
  alias gps='git push'
  alias gs='git status'
}
setAlias
